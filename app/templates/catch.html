{% extends 'base.html' %}

{% block title %}PokeSwap - Trade Offer{% endblock %}

{% block extra_head %}
<style>
    /* Custom styles specific to the Home page */
    .gotta-catch, .trade-offer {
        font-family: 'Comic Sans MS', cursive;
        color: lightslategray;
        text-align: center;
        margin-top: 20px;
    }
    .card-title, .text-center.h2 {
        font-family: 'Comic Sans MS', cursive;
        color: lightblue;
    }
    .pagination a {
        font-family: 'Comic Sans MS', cursive;

    }
</style>
{% endblock %}

{% block content %}
<div class="container text-center mt-5">
    <h1>Catch Pokemon</h1>
    <button id="pokeball-button">
        <img src="../static/images/pokeball-pixel-closed.png" alt="pokeball-button">
    </button>
    <h2>Catch One Pokemon</h2>
    <button id="gacha-one-pull-button">1 Pull</button>
    <div id="one-pull-result"></div>
    <div id="pokemon-img-container"></div>
</div>

{% endblock content %}

{% block scripts %}
<script>
    // Add click sound to the pokeball button
    document.getElementById('pokeball-button').addEventListener('click', function() {
        var audio = new Audio('/static/Click.mp3');
        audio.play();
    });

    // Add event listener for beforeunload event
    window.onbeforeunload = function() {
        // Perform logout action when user leaves the page
        fetch('/logout', { method: 'GET' });
        localStorage.setItem('logged_in', 'false');
    };

    // Add event listener for the Gacha button
    document.getElementById('pokeball-button').addEventListener('click', function() {
        fetch('/gacha', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                // Clear previous Pokemon info
                document.getElementById('pokemon-image-container').innerHTML = '';

                // Display information about the 10 random Pokemon
                data.forEach(pokemon => {
                    let pokemonImg = document.createElement('img');
                    // pokemonInfo.textContent = `${pokemon[0]}: ${pokemon[1]}`;
                    pokemonImg.src = '../static/images/' + pokemon.name + '.png';
                    document.getElementById('pokemon-image-container').appendChild(pokemonImg);
                });
            })
            .catch(error => console.error('Error:', error));
    });
</script>
    
    
<script>
    //click audio
    document.getElementById('gacha-one-pull-button').addEventListener('click', function() {
        var audio = new Audio('/static/Click.mp3');
        audio.play();
    });
    // Add event listener for one-pull gacha button
    document.getElementById('gacha-one-pull-button').addEventListener('click', function() {
        fetch('/gacha_one_pull', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                //clear previous pull
                document.getElementById('one-pull-result').innerHTML = '';
                // Display the result of the one-pull gacha
                document.getElementById('one-pull-result').textContent = `You obtained: ${data[0]}: ${data[1]}`;
            })
            .catch(error => console.error('Error:', error));
    });
</script>
<!-- function to execute when a user clicks the pokeball button -->
<script>
    
    total_pokemon_count = Pokemon.query.count()
    random_pokemon = Pokemon.query.offset(int(random.random() * total_pokemon_count)).first()

    current_user.inventory.append(random_pokemon)
</script>
{% endblock %}

