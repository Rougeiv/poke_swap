{% extends "base.html" %}

{% block title %}
    Trade Offer
{% endblock title %}

{%block extra_head%}
<link rel="stylesheet" href="../static/stylesheets/trade_offer.css">
{%endblock%}

{% block content %}
<div class="container mt-5 mb-5">
    <div class="card my-card-border">
        <div class="card-header text-center bg-dark text-white">
            Trade Offer
        </div>
        <div class="card-body my-card-color">
            <div class="row text-center">
                <div class="col">
                    <h5>Offering</h5>
                    <img src="{{ url_for('static', filename='images/pikachusil.png') }}" alt="Offering" class="img-thumbnail pokemon-image" id="offeringPlaceholder">
                    <button type="button" class="btn btn-primary mt-2" data-toggle="modal" data-target="#pokemonPCModal">
                        Select Pokémon
                    </button>
                </div>
                <div class="col d-flex align-items-center justify-content-center">
                    <span class="mx-3">⇆</span>
                </div>
                <div class="col">
                    <h5>Requesting</h5>
                    <img src="{{ url_for('static', filename='images/pikachusil.png') }}" alt="Requesting" class="img-thumbnail pokemon-image" id="requestingPlaceholder">
                    <button type="button" class="btn btn-primary mt-2" data-toggle="modal" data-target="#requestPokemonModal">
                        Select Pokémon
                    </button>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col text-center">
                    <button id="postTradeButton" class="btn btn-dark">Post</button>
                </div>
                
            </div>
        </div>
    </div>
</div>

<!-- Offer Pokemon Modal -->
<div class="modal fade" id="pokemonPCModal" tabindex="-1" role="dialog" aria-labelledby="pokemonPCModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="pokemonPCModalLabel">Pokémon PC</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body pokepc-background">
                <div class="row">
                    {% for sprite in pokemon_owned %}
                    <div class="col-md-3 text-center">
                        <img src="{{ url_for('static', filename='images/pokemon_gen4_sprites/' + sprite + '.png') }}"
                        class="img-thumbnail pokemon-image selectable-sprite"
                        data-target="#offeringPlaceholder"
                        data-sprite-name="{{ sprite|capitalize }}">
                        <p>{{ sprite }}</p>
                    </div>

                    {% endfor %}
                </div>
                <div class="pokemon-pc page" id="page2" style="display: none;">
                    <div class="row">
                        <!-- Display Pokémon from the second page -->
                    </div>
                </div>
                <!-- Add more pages as needed -->

                <!-- Pagination -->
                <div class="text-center mt-3">
                    <button type="button" class="btn btn-primary mr-2" id="prevPageBtn" disabled>Previous</button>
                    <button type="button" class="btn btn-primary" id="nextPageBtn">Next</button>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Request Pokémon Modal -->
<div class="modal fade" id="requestPokemonModal" tabindex="-1" role="dialog" aria-labelledby="requestPokemonModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="requestPokemonModalLabel">Select Requested Pokémon</h5>
                <button type="button" class="btn btn-close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    {% for sprite in pokemon_sprites %}
                    <div class="col-md-3 text-center">
                        <img src="{{ url_for('static', filename='images/pokemon_gen4_sprites/' + sprite + '.png') }}"
                        class="img-thumbnail pokemon-image selectable-sprite"
                        data-target="#requestingPlaceholder"
                        data-sprite-name="{{ sprite|capitalize }}">
                        <p>{{ sprite }}</p>
                    </div>
                    {% endfor %}
                </div>                
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-close" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Select</button>
            </div>
        </div>
    </div>
</div>


<script>
    $(document).ready(function() {
        let selectedPokemonName1 = null;
        let selectedPokemonName2 = null;
    
        
        $('.selectable-sprite').on('click', function() {
            console.log('Selected Pokemon:', $(this).data('sprite-name'));
            const targetPlaceholder = $(this).data('target');
            $(targetPlaceholder).attr('src', $(this).attr('src'));
            
            if ($(this).data('target') === "#offeringPlaceholder") {
                selectedPokemonName1 = $(this).data('sprite-name');
            } else if ($(this).data('target') === "#requestingPlaceholder") {
                selectedPokemonName2 = $(this).data('sprite-name');
            }
    
            $(this).closest('.modal').modal('hide'); // Close the modal
        });
    
        $('#postTradeButton').on('click', function() {
            $.ajax({
                url: '/post_trade',
                type: 'POST',
                data: {
                    pokemon_name1: selectedPokemonName1,
                    pokemon_name2: selectedPokemonName2
                },
                success: function(response) {
                    console.log(response.success);
                    // Optionally reset or refresh page here
                },
                error: function(xhr) {
                    alert("Error: " + xhr.responseText);
                }
            });
        });
    });
    </script>
    
    
    
{% endblock content %}